<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Account Settings</title>
</head>
<body>
<%- include('fragments/header'); %>
<h1>Account settings</h1>
<p>Manage your account here!</p>
<form action="/accSettings" method="post">
    <label for="fname">First name:</label>
    <input type="text" id="fname" name="fname" value="<%=fname%>"><br><br>
    <label for="lname">Last name:</label>
    <input type="text" id="lname" name="lname" value="<%=lname%>"><br><br>
    <label for="lname">Salary/ Hourly:</label>
    <input type="text" id="salary" name="salary" value="<%=salary%>"><br><br>
    <input type="radio" id="salary" name="salhour" value="Salary" <%=salary_sel%>>
    <label for="html">Salary</label><br>
    <input type="radio" id="hourly" name="salhour" value="Hourly" <%=hourly_sel%>>
    <label for="css">Hourly</label><br>
    <label for="start">DOB:</label>

    <input type="date" id="dob" name="dob"
           value="<%=dob%>"
           min="1901-01-01" max="2020-12-31">
    <br>
    <h3>Expenditures</h3>
    <div class="tableView">
        <table>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Category</th>
                <th>Amount</th>
            </tr>
            <% for(var i =0;i<expend.length;i++){%>
            <tr onclick="edit(this);">
                <td><%=expend[i][0];%></td>
                <td><%=expend[i][1];%></td>
                <td><%=expend[i][2];%></td>
                <td><%=expend[i][3];%></td>
            </tr>
            <%}%>
        </table>
    </div>
    <br>

    <inline>
        <input type="submit" value="Save for Later">
        <input type="submit" value="Submit">
        <input type="submit" value="Save">
    </inline>
</form>
<%// if(remessage == "error") { %>
<h3 style="color:#FF0000"> <%= remessage%> </h3>
<% //} %>

</body>
<script>
    function edit(el){
        console.log(el.cells.length);
        for(let i = 0;i<el.cells.length;i++){
            el.cells[i].innerHTML = "<input type='text' id='edittable' name='edittable' value='" + el.cells[i].innerHTML + "'>";
        }
        el.className = "active";
        el.setAttribute('onclick','');
        hideOnClickOutside(el);
    }
    function commit(el){
        for(let i = 0;i<el.cells.length;i++){
            el.cells[i].innerHTML = "saved";
        }
        el.className = "";
        el.setAttribute('onclick','edit(this);');
    }

    function hideOnClickOutside(element) {
        const outsideClickListener = event => {
            if (!element.contains(event.target)) { // or use: event.target.closest(selector) === null
                commit(element);
                removeClickListener();
            }
        }

        const removeClickListener = () => {
            document.removeEventListener('click', outsideClickListener);
        }

        document.addEventListener('click', outsideClickListener);
    }
</script>
</html>
