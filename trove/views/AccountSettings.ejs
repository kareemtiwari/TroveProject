<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Account Settings</title>
</head>
<style>

</style>
<body>
<%- include('fragments/header'); %>
<h1>Account settings</h1>
<p>Manage your account here!</p>
<form action="/accSettings" method="post">
    <label for="fname">First name:</label>
    <input type="text" id="fname" name="fname" value="<%=fname%>"><br><br>
    <label for="lname">Last name:</label>
    <input type="text" id="lname" name="lname" value="<%=lname%>"><br><br>
    <label for="lname">Salary/ Hourly:</label>
    <input type="text" id="salary" name="salary" value="<%=salary%>"><br><br>
    <input type="radio" id="salary" name="salhour" value="Salary" <%=salary_sel%>>
    <label for="html">Salary</label><br>
    <input type="radio" id="hourly" name="salhour" value="Hourly" <%=hourly_sel%>>
    <label for="css">Hourly</label><br>
    <label for="start">DOB:</label>

    <input type="date" id="dob" name="dob"
           value="<%=dob%>"
           min="1901-01-01" max="2020-12-31">
    <br>
    <h3>Expenditures</h3>
    <div class="tableView">
        <p>Click on a row to edit, Rows are saved when you click off</p>
        <table id="expTable">
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Category</th>
                <th>Amount</th>
            </tr>
            <% for(var i =0;i<expend.length;i++){%>
            <tr onclick="edit(this);">
                <td><%=expend[i][0];%></td>
                <td><%=expend[i][1];%></td>
                <td><%=expend[i][2];%></td>
                <td><%=expend[i][3];%></td>
            </tr>
            <%}%>
        </table>
        <button type="button" onclick="addE();">Add New Expenditure</button>
        <button type="button" id="del" onclick="deleteE();">Delete Selected Expenditure</button>
    </div>
    <br>

    <inline>
        <input type="submit" value="Save for Later">
        <input type="submit" value="Submit">
        <input type="submit" value="Save">
    </inline>
</form>
<%// if(remessage == "error") { %>
<h3 style="color:#FF0000"> <%= remessage%> </h3>
<% //} %>

</body>
<script>
    function edit(el){
            const input = document.createElement("input");
            input.type = "text";
            input.value = el.cells[0].innerHTML;
            el.cells[0].innerHTML = "";
            el.cells[0].append(input);

        const input2 = document.createElement("input");
        input2.type = "text";
        input2.value = el.cells[3].innerHTML;
        el.cells[3].innerHTML = "";
        el.cells[3].append(input2);

        const input3 = document.createElement("select");
        let optlist1 = ["Fixed","Variable"];
        for (var i = 0; i<=optlist1.length; i++){
            var opt = document.createElement('option');
            opt.value = optlist1[i];
            opt.innerHTML = optlist1[i];
            input3.appendChild(opt);
        }
        input3.value = el.cells[1].innerHTML;
        el.cells[1].innerHTML = "";
        el.cells[1].append(input3);

        const input4 = document.createElement("select");
        let optlist = ["Housing","Transportation","Food","Education","Entertainment","Miscellaneous"];
        for (var i = 0; i<=optlist.length; i++){
            var opt = document.createElement('option');
            opt.value = optlist[i];
            opt.innerHTML = optlist[i];
            input4.appendChild(opt);
        }
        input4.value = el.cells[2].innerHTML;
        el.cells[2].innerHTML = "";
        el.cells[2].append(input4);

        el.className = "selrow";
        el.setAttribute('onclick','');
        hideOnClickOutside(el);
    }
    function commit(el){
        for(let i = 0;i<el.cells.length;i++){
            const save = el.cells[i].children[0].value;
            el.cells[i].innerHTML = save;

        }
        el.className = "";
        console.log(el.innerHTML);
        el.setAttribute('onclick','edit(this);');
    }

    function addE(){
        const table = document.getElementById("expTable");
        const newRow = table.insertRow();
        newRow.setAttribute("onclick","edit(this);");
        const c1 = newRow.insertCell();
        c1.innerHTML = "New Expenditure";
        const c2 = newRow.insertCell();
        c2.innerHTML = "Variable";
        const c3 = newRow.insertCell();
        c3.innerHTML = "Miscellaneous";
        const c4 = newRow.insertCell();
        c4.innerHTML = "0";

    }

    function deleteE(){
        const selrow = document.getElementsByClassName("selrow");
        const table = document.getElementById("expTable");
        console.log(selrow.rowIndex);
        table.deleteRow(selrow.rowIndex);
        //row.remove();

    }

    function hideOnClickOutside(element) {
        const outsideClickListener = event => {
            if (!element.contains(event.target)&&!element.contains(document.getElementById("del"))) { // or use: event.target.closest(selector) === null
                commit(element);
                removeClickListener();
            }
        }

        const removeClickListener = () => {
            document.removeEventListener('mousedown', outsideClickListener);
        }

        document.addEventListener('mousedown', outsideClickListener);
    }
</script>
</html>
